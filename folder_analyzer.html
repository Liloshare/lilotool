<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í´ë” íŒŒì¼ ìˆ˜ ë¶„ì„ê¸°</title>
    <style>
  :root{
    --bg: #f4f6fb;
    --text: #111827;
    --muted: rgba(17,24,39,0.55);
    --border: rgba(17,24,39,0.10);
    --card: rgba(255,255,255,0.78);
    --card-strong: rgba(255,255,255,0.88);
    --shadow: 0 18px 45px rgba(17,24,39,0.12);
    --shadow-hover: 0 26px 70px rgba(17,24,39,0.16);
    --radius: 26px;

    --accent-dark: rgba(17,24,39,0.92);
    --accent-dark-hover: rgba(17,24,39,0.86);
    --accent-soft: rgba(167,139,250,0.22);
    --accent-blue: rgba(99,102,241,1);
  }

  *{ margin:0; padding:0; box-sizing:border-box; }

  body{
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Malgun Gothic", sans-serif;
    background:
      radial-gradient(1200px 600px at 15% 10%, rgba(167,139,250,0.18), transparent 55%),
      radial-gradient(900px 500px at 85% 15%, rgba(56,189,248,0.16), transparent 55%),
      radial-gradient(1000px 600px at 70% 85%, rgba(251,113,133,0.14), transparent 55%),
      var(--bg);
    min-height: 100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding: 22px;
    color: var(--text);
  }

  .container{
    width: 100%;
    max-width: 1400px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    padding: 34px;
    position:relative;
    overflow:hidden;
  }
  .container::before{
    content:"";
    position:absolute;
    inset:-2px -2px auto -2px;
    height: 110px;
    background: linear-gradient(135deg,
      rgba(167,139,250,0.35),
      rgba(56,189,248,0.30),
      rgba(251,113,133,0.22)
    );
    opacity:.85;
    pointer-events:none;
  }
  .container > *{ position:relative; z-index:1; }

  h1{
    color: rgba(17,24,39,0.92);
    margin-bottom: 22px;
    font-size: 26px;
    text-align:center;
    letter-spacing: -0.02em;
    font-weight: 900;
  }

  /* Upload */
  .upload-area{
    border: 2px dashed rgba(17,24,39,0.18);
    border-radius: 22px;
    padding: 56px 18px;
    text-align:center;
    background: rgba(255,255,255,0.60);
    cursor:pointer;
    transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
    margin-bottom: 22px;
    box-shadow: 0 14px 34px rgba(17,24,39,0.10);
  }
  .upload-area:hover{
    border-color: rgba(99,102,241,0.35);
    background: rgba(255,255,255,0.78);
    transform: translateY(-2px);
    box-shadow: 0 18px 45px rgba(17,24,39,0.12);
  }
  .upload-icon{ font-size: 46px; margin-bottom: 12px; }
  .upload-text{ color: var(--muted); font-size: 15px; }
  input[type="file"]{ display:none; }

  /* Status */
  .status{
    text-align:center;
    padding: 10px 14px;
    border-radius: 999px;
    margin-bottom: 16px;
    display:none;
    font-weight: 800;
    font-size: 12px;
    border: 1px solid rgba(17,24,39,0.10);
    background: rgba(255,255,255,0.72);
    box-shadow: 0 14px 34px rgba(17,24,39,0.12);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  .status.info{
    background: rgba(56,189,248,0.14);
    color: rgba(30,64,175,1);
    border-color: rgba(56,189,248,0.16);
  }
  .status.success{
    background: rgba(34,197,94,0.14);
    color: rgba(22,101,52,1);
    border-color: rgba(34,197,94,0.14);
  }

  /* Summary */
  .summary{
    background: rgba(255,255,255,0.62);
    border: 1px solid rgba(17,24,39,0.10);
    padding: 14px 16px;
    border-radius: 22px;
    margin-bottom: 16px;
    display:none;
    box-shadow: 0 14px 34px rgba(17,24,39,0.10);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .summary.show{ display:block; }
  .summary-item{
    display:inline-block;
    margin-right: 18px;
    color: rgba(17,24,39,0.75);
    font-weight: 900;
    font-size: 13px;
  }

  /* Progress */
  .progress{
    width:100%;
    height: 10px;
    background: rgba(17,24,39,0.10);
    border-radius: 999px;
    overflow:hidden;
    margin-bottom: 16px;
    display:none;
  }
  .progress.show{ display:block; }
  .progress-bar{
    height:100%;
    width:0%;
    background: linear-gradient(90deg,
      rgba(167,139,250,0.9),
      rgba(56,189,248,0.85),
      rgba(251,113,133,0.8)
    );
    transition: width .25s ease;
    border-radius: 999px;
  }

  /* Table container */
  .table-container{
    max-height: 520px;
    overflow:auto;
    border-radius: 22px;
    border: 1px solid rgba(17,24,39,0.10);
    margin-bottom: 16px;
    background: rgba(255,255,255,0.55);
    box-shadow: 0 14px 34px rgba(17,24,39,0.10);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }

  table{
    width:100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-bottom: 0;
    display:none;
    background: transparent;
  }
  table.show{ display: table; }

  th{
    position: sticky;
    top: 0;
    z-index: 2;
    padding: 12px;
    text-align:left;
    font-weight: 900;
    font-size: 13px;
    color: rgba(17,24,39,0.80);
    background: rgba(255,255,255,0.78);
    border-bottom: 1px solid rgba(17,24,39,0.10);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }

  td{
    padding: 10px 12px;
    border-bottom: 1px solid rgba(17,24,39,0.08);
    color: rgba(17,24,39,0.80);
    background: transparent;
    font-size: 13px;
  }

  tr:hover td{
    background: rgba(255,255,255,0.55);
  }

  td.number{
    text-align:center;
    font-weight: 900;
    color: rgba(17,24,39,0.85);
  }

  td.indent-1{ padding-left: 30px; }
  td.indent-2{ padding-left: 50px; }
  td.indent-3{ padding-left: 70px; }
  td.indent-4{ padding-left: 90px; }

  .folder-row td{
    background: rgba(167,139,250,0.10);
    font-weight: 900;
  }

  .file-types{ font-size: 12px; color: var(--muted); margin-top: 4px; }
  .file-type-badge{
    display:inline-block;
    background: rgba(255,255,255,0.70);
    border: 1px solid rgba(17,24,39,0.08);
    padding: 2px 8px;
    border-radius: 999px;
    margin-right: 6px;
    margin-bottom: 4px;
    color: rgba(17,24,39,0.70);
    font-weight: 800;
    font-size: 11px;
  }

  /* Buttons */
  .btn-group{ display:none; gap: 12px; }
  .btn-group.show{ display:flex; }

  .btn{
    flex: 1;
    background: var(--accent-dark);
    color:white;
    border: 1px solid rgba(255,255,255,0.12);
    padding: 12px 18px;
    border-radius: 18px;
    font-size: 14px;
    font-weight: 900;
    cursor:pointer;
    transition: transform .2s ease, box-shadow .2s ease, background .2s ease;
    box-shadow: 0 12px 28px rgba(17,24,39,0.12);
  }
  .btn:hover{
    transform: translateY(-2px);
    background: var(--accent-dark-hover);
    box-shadow: 0 16px 38px rgba(17,24,39,0.16);
  }
  .btn:active{ transform: translateY(0); }

  .btn.secondary{
    background: rgba(255,255,255,0.80);
    color: rgba(17,24,39,0.80);
    border: 1px solid rgba(17,24,39,0.10);
  }
  .btn.secondary:hover{
    background: rgba(255,255,255,0.92);
  }
</style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ í´ë” íŒŒì¼ ìˆ˜ ë¶„ì„ê¸°</h1>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“‚</div>
            <div class="upload-text">
                <strong>í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”</strong><br>
                <small>í´ë¦­í•˜ì—¬ í´ë” ì„ íƒ</small>
            </div>
            <input type="file" id="folderInput" webkitdirectory directory multiple>
        </div>

        <div class="progress" id="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="status" id="status"></div>

        <div class="summary" id="summary"></div>

        <div class="table-container">
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>í´ë” ê²½ë¡œ</th>
                        <th style="text-align: center; width: 120px;">íŒŒì¼ ê°œìˆ˜</th>
                        <th style="width: 400px;">íŒŒì¼ í˜•ì‹</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div class="btn-group" id="btnGroup">
            <button class="btn secondary" id="newAnalysisBtn">ğŸ”„ ìƒˆë¡œìš´ ë¶„ì„</button>
            <button class="btn" id="downloadBtn">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let currentData = [];
        let rootFolderName = '';

        const uploadArea = document.getElementById('uploadArea');
        const folderInput = document.getElementById('folderInput');
        const status = document.getElementById('status');
        const summary = document.getElementById('summary');
        const resultTable = document.getElementById('resultTable');
        const tableBody = document.getElementById('tableBody');
        const downloadBtn = document.getElementById('downloadBtn');
        const newAnalysisBtn = document.getElementById('newAnalysisBtn');
        const btnGroup = document.getElementById('btnGroup');
        const progress = document.getElementById('progress');
        const progressBar = document.getElementById('progressBar');

        uploadArea.addEventListener('click', () => {
            folderInput.click();
        });

        folderInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            processFiles(files);
        });

        newAnalysisBtn.addEventListener('click', () => {
            resetUI();
            folderInput.click();
        });

        function resetUI() {
            currentData = [];
            rootFolderName = '';
            tableBody.innerHTML = '';
            resultTable.classList.remove('show');
            btnGroup.classList.remove('show');
            summary.classList.remove('show');
            status.style.display = 'none';
            uploadArea.style.display = 'block';
            folderInput.value = '';
        }

        function processFiles(files) {
            if (files.length === 0) {
                showStatus('í´ë”ê°€ ë¹„ì–´ìˆê±°ë‚˜ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'info');
                return;
            }

            uploadArea.style.display = 'none';
            progress.classList.add('show');
            progressBar.style.width = '50%';

            const folderMap = new Map();
            const firstPath = files[0].webkitRelativePath || '';
            rootFolderName = firstPath.split('/')[0] || 'ì„ íƒí•œ í´ë”';

            files.forEach(file => {
                const path = file.webkitRelativePath || file.name;
                const pathParts = path.split('/');
                
                if (file.name.startsWith('.')) return;
                
                const ext = file.name.split('.').pop().toLowerCase();
                
                if (pathParts.length >= 2) {
                    const directParentPath = pathParts.slice(0, -1).join('/');
                    
                    if (!folderMap.has(directParentPath)) {
                        folderMap.set(directParentPath, { count: 0, extensions: {} });
                    }
                    
                    const folderData = folderMap.get(directParentPath);
                    folderData.count++;
                    if (ext && file.name.includes('.')) {
                        folderData.extensions[ext] = (folderData.extensions[ext] || 0) + 1;
                    }
                }
            });

            currentData = buildTree(folderMap);

            progressBar.style.width = '100%';
            setTimeout(() => {
                progress.classList.remove('show');
                displayResults();
            }, 300);
        }

        function buildTree(folderMap) {
            const paths = Array.from(folderMap.keys()).sort();
            const seen = new Set();
            const tree = [];
            
            paths.forEach(path => {
                if (seen.has(path)) return;
                seen.add(path);
                
                const parts = path.split('/');
                const depth = parts.length - 1;
                const name = parts[parts.length - 1];
                const data = folderMap.get(path);
                
                tree.push({
                    path: path,
                    name: name,
                    depth: depth,
                    count: data.count,
                    extensions: data.extensions,
                    displayPath: parts.slice(1).join('/') || name,
                    pathParts: parts.slice(1)
                });
            });
            
            return tree;
        }

        function formatExtensions(extensions) {
            const sorted = Object.entries(extensions)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            if (sorted.length === 0) return '-';
            
            return sorted.map(([ext, count]) => 
                `<span class="file-type-badge">${ext}: ${count}ê°œ</span>`
            ).join('');
        }

        function displayResults() {
            if (currentData.length === 0) {
                showStatus('í•˜ìœ„ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                uploadArea.style.display = 'block';
                return;
            }

            tableBody.innerHTML = '';
            
            const rootRow = document.createElement('tr');
            rootRow.className = 'folder-row';
            const totalFiles = currentData.reduce((sum, item) => sum + item.count, 0);
            
            const rootExtensions = {};
            currentData.forEach(item => {
                Object.entries(item.extensions).forEach(([ext, count]) => {
                    rootExtensions[ext] = (rootExtensions[ext] || 0) + count;
                });
            });
            
            rootRow.innerHTML = `
                <td><strong>ğŸ“ ${rootFolderName}</strong></td>
                <td class="number">${totalFiles}</td>
                <td><div class="file-types">${formatExtensions(rootExtensions)}</div></td>
            `;
            tableBody.appendChild(rootRow);

            const displayedPaths = new Set();
            
            currentData.forEach(item => {
                if (displayedPaths.has(item.displayPath)) return;
                displayedPaths.add(item.displayPath);
                
                const tr = document.createElement('tr');
                const indentClass = `indent-${Math.min(item.depth, 4)}`;
                const icon = item.count > 0 ? 'ğŸ“„' : 'ğŸ“';
                
                tr.innerHTML = `
                    <td class="${indentClass}">${icon} ${item.displayPath}</td>
                    <td class="number">${item.count}</td>
                    <td><div class="file-types">${formatExtensions(item.extensions)}</div></td>
                `;
                tableBody.appendChild(tr);
            });

            const totalFolders = displayedPaths.size;
            const uniqueExtensions = new Set();
            currentData.forEach(item => {
                Object.keys(item.extensions).forEach(ext => uniqueExtensions.add(ext));
            });
            
            summary.innerHTML = `
                <span class="summary-item">ğŸ“‚ í•˜ìœ„ í´ë”: ${totalFolders}ê°œ</span>
                <span class="summary-item">ğŸ“„ ì´ íŒŒì¼: ${totalFiles}ê°œ</span>
                <span class="summary-item">ğŸ“‹ íŒŒì¼ í˜•ì‹: ${uniqueExtensions.size}ì¢…ë¥˜</span>
            `;

            resultTable.classList.add('show');
            btnGroup.classList.add('show');
            summary.classList.add('show');
            showStatus('âœ“ ë¶„ì„ ì™„ë£Œ', 'success');
        }

        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        function getColorForDepth(depth) {
            const colors = [
                'FFE4E1',
                'E0F2FF',
                'E8F5E9',
                'FFF9E6',
                'F3E5F5',
            ];
            return colors[depth % colors.length];
        }

        downloadBtn.addEventListener('click', () => {
            const excelData = [];
            const maxDepth = Math.max(...currentData.map(item => item.pathParts.length), 0);
            const seenPaths = new Set();
            
            currentData.forEach(item => {
                if (seenPaths.has(item.displayPath)) return;
                seenPaths.add(item.displayPath);
                
                const extensions = Object.entries(item.extensions).sort((a, b) => b[1] - a[1]);
                
                if (extensions.length === 0) {
                    const row = {
                        'ì„ íƒ íŒŒì¼ ëª…': item.pathParts[0] || item.name,
                        'ì´ íŒŒì¼ ìˆ˜': item.count
                    };
                    
                    for (let i = 0; i < maxDepth; i++) {
                        row[`ë ˆë²¨${i + 1}`] = item.pathParts[i] || '';
                        row[`ë ˆë²¨${i + 1}_ìˆ˜ëŸ‰`] = '';
                        row[`ë ˆë²¨${i + 1}_íŒŒì¼`] = '';
                    }
                    
                    excelData.push(row);
                } else {
                    extensions.forEach(([ext, count], idx) => {
                        const row = {
                            'ì„ íƒ íŒŒì¼ ëª…': idx === 0 ? (item.pathParts[0] || item.name) : '',
                            'ì´ íŒŒì¼ ìˆ˜': idx === 0 ? item.count : ''
                        };
                        
                        for (let i = 0; i < maxDepth; i++) {
                            if (i < item.pathParts.length - 1) {
                                row[`ë ˆë²¨${i + 1}`] = item.pathParts[i] || '';
                                row[`ë ˆë²¨${i + 1}_ìˆ˜ëŸ‰`] = '';
                                row[`ë ˆë²¨${i + 1}_íŒŒì¼`] = '';
                            } else if (i === item.pathParts.length - 1) {
                                row[`ë ˆë²¨${i + 1}`] = item.pathParts[i] || '';
                                row[`ë ˆë²¨${i + 1}_ìˆ˜ëŸ‰`] = count;
                                row[`ë ˆë²¨${i + 1}_íŒŒì¼`] = ext;
                            } else {
                                row[`ë ˆë²¨${i + 1}`] = '';
                                row[`ë ˆë²¨${i + 1}_ìˆ˜ëŸ‰`] = '';
                                row[`ë ˆë²¨${i + 1}_íŒŒì¼`] = '';
                            }
                        }
                        
                        excelData.push(row);
                    });
                }
            });

            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'í´ë” ë¶„ì„');

            const colWidths = [
                { wch: 35 },
                { wch: 12 }
            ];
            for (let i = 0; i < maxDepth; i++) {
                colWidths.push({ wch: 25 });
                colWidths.push({ wch: 10 });
                colWidths.push({ wch: 10 });
            }
            ws['!cols'] = colWidths;

            const range = XLSX.utils.decode_range(ws['!ref']);
            let currentFolder = '';
            let colorIndex = 0;
            
            for (let R = 1; R <= range.e.r; ++R) {
                const folderCell = ws[XLSX.utils.encode_cell({r: R, c: 0})];
                
                if (folderCell && folderCell.v) {
                    currentFolder = folderCell.v;
                    colorIndex++;
                }
                
                const bgColor = getColorForDepth(colorIndex);
                
                for (let C = 0; C <= range.e.c; ++C) {
                    const cellAddress = XLSX.utils.encode_cell({r: R, c: C});
                    if (!ws[cellAddress]) ws[cellAddress] = {t: 's', v: ''};
                    
                    ws[cellAddress].s = {
                        fill: { fgColor: { rgb: bgColor } },
                        border: {
                            top: {style: 'thin', color: {rgb: 'CCCCCC'}},
                            bottom: {style: 'thin', color: {rgb: 'CCCCCC'}},
                            left: {style: 'thin', color: {rgb: 'CCCCCC'}},
                            right: {style: 'thin', color: {rgb: 'CCCCCC'}}
                        },
                        alignment: { vertical: 'center', horizontal: 'left' }
                    };
                }
            }

            for (let C = 0; C <= range.e.c; ++C) {
                const cellAddress = XLSX.utils.encode_cell({r: 0, c: C});
                ws[cellAddress].s = {
                    fill: { fgColor: { rgb: '4F46E5' } },
                    font: { bold: true, color: { rgb: 'FFFFFF' } },
                    border: {
                        top: {style: 'thin', color: {rgb: '000000'}},
                        bottom: {style: 'thin', color: {rgb: '000000'}},
                        left: {style: 'thin', color: {rgb: '000000'}},
                        right: {style: 'thin', color: {rgb: '000000'}}
                    },
                    alignment: { vertical: 'center', horizontal: 'center' }
                };
            }

            const fileName = `í´ë”_íŒŒì¼ìˆ˜_ìš”ì•½_${rootFolderName}.xlsx`;
            XLSX.writeFile(wb, fileName);

            showStatus('âœ“ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ', 'success');
        });
    </script>
</body>
</html>
